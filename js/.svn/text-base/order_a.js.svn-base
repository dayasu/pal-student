function ajaxSuccess(data){if(data.status=="0"){document.pay_form.trade_no.value=data.order_id;document.pay_form.ordsubject.value="爱淘学订单"+data.order_id;document.pay_form.ordtotal_fee.value=$("#order_all").text();document.pay_form.ordbody.value=$("#remark").val()?$("#remark").val():"备注为空";document.pay_form.ordshow_url.value="<{:U('Goods/showOrder')}>";document.pay_form.submit()}}function ajaxFail(){alert("网络故障，请重试！")}function winOn(){$("#cover").fadeIn(200);$("#win").fadeIn(300)}function winOff(){$("#cover").fadeOut(300);$("#win").fadeOut(400)}function Order(){this.buttonMinus=$(".icon-minus").eq(0);this.buttonPlus=$(".icon-plus").eq(0);this.classesName=$("#order_class").text();this.inputBox=$(".add-input").eq(0);this.limitedTimes=$("#limitedn").val();this.classPrice=parseInt($("#order_single").text());this.orderAllPrice=$("#order_all");this.price=$("#order_pay_alls");this.button=$("#order_sumit");this.init=(function(that){with(that){return function(){orderAllPrice.text(classPrice*limitedTimes);buttonMinus.bind("click",function(){var value=parseInt(inputBox.val());console.log(limitedTimes);if(value>limitedTimes){value=value-1;orderAllPrice.text(classPrice*value);price.text(classPrice*value+"元");inputBox.val(value)}});buttonPlus.bind("click",function(){var value=parseInt(inputBox.val());value=value+1;orderAllPrice.text(classPrice*value);price.text(classPrice*value+"元");inputBox.val(value)});button.bind("click",function(){if(parseInt(inputBox.val())<limitedTimes){winOn();$("#limitedNum").text(limitedTimes);return false}$.ajax({type:"post",url:url,dataType:"json",data:{remark:$("#remark").val(),num:$(".add-input").val(),gid:$("#gid").val()},success:ajaxSuccess,error:ajaxFail,})});inputBox.keyup(function(){var value=this.value=this.value.replace(/\D/g,"");orderAllPrice.text(classPrice*value);price.text(classPrice*value+"元")})}}})(this)}$(document).ready(function(){var a=new Order();a.init();$(".order_addr_box").bind("click",function(){$(".order_addr_box").removeClass("order_addr_box_active").attr("flag","0");$(".triangle").removeClass("triangle_active");$(this).find(".triangle").addClass("triangle_active");$(this).addClass("order_addr_box_active").attr("flag","1")});$("#remark").bind("click",function(){$(this).css({height:"90px",marginTop:"0px"})}).bind("blur",function(){$(this).css({height:"30px",marginTop:"30px"})});$("#cover").click(winOff);console.log("aaa")});