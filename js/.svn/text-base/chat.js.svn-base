var BOSH_SERVICE="http://192.168.1.11:7070/http-bind/";var connection=null;var connected=false;var jid="";function onConnect(status){if(status==Strophe.Status.CONNFAIL){alert("连接失败！")}else{if(status==Strophe.Status.AUTHFAIL){alert("登录失败！")}else{if(status==Strophe.Status.DISCONNECTED){alert("连接断开！");connected=false}else{if(status==Strophe.Status.CONNECTED){alert("连接成功，可以开始聊天了！");connected=true;connection.addHandler(onMessage,null,"message",null,null,null);connection.send($pres().tree());chatpwdDlg.close().remove();$(".chat-win").show();$("#input-contacts").val(phone+"@serverpal.example.com")}}}}}function onMessage(msg){var from=msg.getAttribute("from");var type=msg.getAttribute("type");var elems=msg.getElementsByTagName("body");if(type=="chat"&&elems.length>0){var body=elems[0];$("#msg ul").append('<li class="chat-cont-recv">'+Strophe.getText(body)+"<br>--来自"+from.substr(0,11)+"</li>");var msg111=document.getElementById("msg");msg111.scrollTop=msg111.scrollHeight}return true}$(document).ready(function(){$("#btn-login").click(function(){if(!connected){connection=new Strophe.Connection(BOSH_SERVICE);connection.connect($("#input-jid").val(),$("#input-pwd").val(),onConnect);jid=$("#input-jid").val()}});$("#btn-send").click(function(){if(connected){if($("#input-contacts").val()==""){alert("请输入联系人！");return}var msg=$msg({to:$("#input-contacts").val(),from:jid,type:"chat"}).c("body",null,$("#input-msg").val());connection.send(msg.tree());$("#msg ul").append('<li class="chat-cont-send">'+$("#input-msg").val()+"</li>");$("#input-msg").val("");var msg111=document.getElementById("msg");msg111.scrollTop=msg111.scrollHeight}else{alert("请先登录！")}})});