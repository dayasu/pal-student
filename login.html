<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="./css/login.css">
    <script type="text/javascript">
        $.ajax({
            type: 'post',
            async: "ture",
            header: "Authorization ",
            username: "test_client",
            password: " test_pass",
            dataType: 'json',
            url: "http://120.25.202.14/pal/public/index.php?_url=/common/code",
            data: {
                phone: 18821769989,
            },

            success: function(data) {
                console.log(data);
            },
            error: function(xhr, xx, yy) {
                console.log(xx, yy);

            }
        });




        // *******************************************************************************
        $(function() {
            var role_type = 2;
            var phone;
            var ambassador_check_num;
            var error = '<i class="icon-remove-sign"></i>';
            var right = '<i class="icon-ok"></i>';
            // 检测手机号码是否格式正确
            $("#phone").blur(function() {
                var str = $("#phone").val();
                var re = /^1[8345]\d{9}$/;
                if (!re.test(str)) {
                    // 错误
                    error_tip("请输入手机号码");
                    return false;
                } else {
                    // 正确
                    $('.error_tip.phone').show();
                    $('.error_tip.phone').html(right);
                    $('.error_tip.phone').css("color", "green");
                    $('#phone').removeClass('error');
                    return true;
                }
            });
            // 获取验证码
            $('#get_check_num').click(function(event) {
                event.preventDefault()
                var clock = 120;
                var countdown;
                $.post(sendchecknumurl, {
                        phone: $("#phone").val(),
                        role_type: 2
                    },
                    function(data) {
                        if (data.status == 1) {
                            error_tip("信息输入不完整");
                            $('#get_check_num').html('获取验证码');
                        } else if (data.status == 2) {
                            error_tip("手机号输入不正确");
                            $('#get_check_num').html('获取验证码');
                        } else if (data.status == 3) {
                            error_tip("角色非法");
                            $('#get_check_num').html('获取验证码');
                        } else if (data.status == 6) {
                            error_tip("已注册为家教");
                            $('#get_check_num').html('获取验证码');
                        } else if (data.status == 7) {
                            error_tip("已注册为家长");
                            $('#get_check_num').html('获取验证码');
                        } else if (data.status == 8) {
                            error_tip("间隔不超过120s");
                            $('#get_check_num').html('获取验证码');
                        } else if (data.status == 0) {
                            countdown = setInterval(countDown, 1000);
                            $('#get_check_num').attr("disabled", "true");
                            $('#get_check_num').removeClass('active');
                        }
                    },
                    'json'
                );
                // 等待
                var str = $("#phone").val();
                var re = /^1[8345]\d{9}$/;
                if (!re.test(str)) {
                    // 错误
                } else {
                    // 正确
                    $('#get_check_num').html('<i class="icon-spinner icon-spin"></i>');
                }

                function countDown() {
                    $('#get_check_num').html(clock + "s后重发");
                    if (clock == 0) {
                        clearInterval(countdown);
                        $('#get_check_num').html('获取验证码');
                        $('#get_check_num').attr("disabled", "false");
                        $('#get_check_num').addClass('active');
                    }
                    clock--;
                }
            });
            // 检测验证码是否输入
            $("#ambassador_check_num").blur(function() {
                var str = $("#ambassador_check_num").val();
                if (str == '') {
                    // 错误
                    $('.error_tip.yzm').show();
                    $('.error_tip.yzm').css("color", "red");
                    $('.error_tip.yzm').html(error + "请输入验证码");
                    $('#ambassador_check_num').addClass('error');
                    return false;
                } else {
                    // 正确
                    $('.error_tip.yzm').show();
                    $('.error_tip.yzm').html('');
                    $('.error_tip.yzm').css("color", "green");
                    $('#ambassador_check_num').removeClass('error');
                    return true;
                }
            });
            // 提交注册
            $("#submit").click(function() {
                var $box = document.getElementById('ty');
                if (!$box.checked) {
                    return false;
                }
                if ($("#phone").val() == '') {
                    error_tip('请输入手机号码');
                    return false;
                };
                if ($("#ambassador_check_num").val() == '') {
                    $('.error_tip.yzm').show();
                    $('.error_tip.yzm').html(error + "请输入验证码");
                    $('#ambassador_check_num').addClass('error');
                    return false;
                }
                $.post(
                    registerurl, {
                        role_type: 2,
                        phone: $("#phone").val(),
                        ambassador_check_num: $("#ambassador_check_num").val()
                    },
                    function(data) {
                        if (data.status == 0) {
                            window.location.href = "/pal_studio/index.php/Register/userSecond.html";
                        } else if (data.status == 1) {
                            error_tip("信息输入不完整");
                        } else if (data.status == 2) {
                            error_tip("手机号输入不正确");
                        } else if (data.status == 3) {
                            error_tip("手机验证码错误");
                        } else if (data.status == 6) {
                            error_tip("已被注册为家教");
                        } else if (data.status == 7) {
                            error_tip("已被注册为家长");
                        }
                    }, 'json'
                );

            });

            function error_tip(tip) {
                $('.error_tip.phone').show();
                $('.error_tip.phone').html(error + tip);
                $('.error_tip.phone').css("color", "red");
                $('#phone').addClass('error');
            }
            //按enter确定
            $(document).keypress(function(e) {
                if (e.which == 13) {
                    $("#submit").click();
                }
            });

            $("#submit").css('background', '#7d7d7d');
            $("#ty").change(function() {
                var $box = document.getElementById('ty');
                if ($box.checked) {
                    $("#submit").css('background', '#36a48c');
                    return false;
                } else {
                    $("#submit").css('background', '#7d7d7d');
                }
            });
        });
        // *****************************************************************************************
    </script>
</head>

<body>
    <div class="container">
        <div class="logo_box">
            <a href="/pal_studio/index.php/Index/index.html"></a>
        </div>
        <div class="wrap">
            <div class="register-box first">
                <div class="pic_2"></div>
                <div class="content">
                    <div class="input-group">
                        <input placeholder="手机号" type="text" name="phone" id="phone" />
                        <span class="error_tip phone"></span>
                    </div>
                    <div class="input-group">
                        <input placeholder="验证码" type="text" name="ambassador_check_num" id="ambassador_check_num" class="yzm" />
                        <button id="get_check_num" class="get_yzm active">获取验证码</button>
                        <span class="error_tip yzm"></span>
                    </div>
                    <!--*******************************************************************-->
                    <div class="input-group">
                        <!--<label for="userName">用户名：</label>-->
                        <input type="text" placeholder="用户名" id="userName" name="userName" />
                    </div>
                    <div class="input-group">
                        <!--<label for="password">密码：</label>-->
                        <input type="password" placeholder="密码" id="password" name="password" />
                    </div>

                    <div class="input-group">
                        <!--<label for="password">密码：</label>-->
                        <input type="password" placeholder="密码" id="password" name="password" />
                    </div>

                    <div class="input-group">
                        <span id="submit">注册</span><span class="had_tip">已有账号，立即<a href="/pal_studio/index.php/Login/index.html">登录</a></span>
                    </div>

                    <!--*******************************************************************-->
                    <div class="input-group checkbox">
                        <input type="checkbox" id="ty">
                        <a href="/pal_studio/index.php/About/ServiceProtocol.html">同意《爱淘学服务协议》</a>
                    </div>
                </div>
            </div>
        </div>
    </div>


</body>

</html>